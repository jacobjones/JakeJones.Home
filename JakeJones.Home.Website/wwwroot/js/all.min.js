var ajax={};function ready(e){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?e():document.addEventListener("DOMContentLoaded",e)}function pageIs(e){return document.body.classList?document.body.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(document.body.className)}function loaded(e){e.parentNode.classList&&e.parentNode.classList.remove("loading")}ajax.get=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){200<=n.status&&n.status<400&&t(JSON.parse(n.responseText))},n.onerror=function(){},n.send()},ready(function(){if(pageIs("home")){var n=simpleConnect.connect("music-text","current-album-wrapper",{lineWidth:2,color:"#fff",type:"horizontal",offset:20});document.getElementById("current-album-wrapper").sdrag(function(){simpleConnect.repaintConnection(n)}),ajax.get("/api/music/current",function(e){var t=document.getElementById("current-album");loaded(t),t&&(t.src=e.imageUrl,t.alt=e.title,t.title=e.title,simpleConnect.repaintConnection(n))});var o=simpleConnect.connect("book-text","current-book-wrapper",{lineWidth:2,color:"#fff",type:"horizontal",offset:20});document.getElementById("current-book-wrapper").sdrag(function(){simpleConnect.repaintConnection(o)}),window.onresize=function(){simpleConnect.repaintConnection(n),simpleConnect.repaintConnection(o)},ajax.get("/api/books/current",function(e){var t=document.getElementById("current-book");loaded(t),e&&(t.src=e.imageUrl,t.alt=e.title,t.title=e.title,simpleConnect.repaintConnection(o))})}}),Element.prototype.sdrag=function(i,t,a){var r=0,c=0,l=this,n=!1;function o(e){var t={};if(i&&i(l,e.pageX,r,e.pageY,c,t),"vertical"!==a){var n="pageX"in t?t.pageX:e.pageX;"startX"in t&&(r=t.startX),0=="skipX"in t&&(l.style.left=n-r+"px")}if("horizontal"!==a){var o="pageY"in t?t.pageY:e.pageY;"startY"in t&&(c=t.startY),0=="skipY"in t&&(l.style.top=o-c+"px")}}this.addEventListener("mousedown",function(e){if(e.preventDefault(),!(e.currentTarget instanceof HTMLElement||e.currentTarget instanceof SVGElement))throw new Error("Your target must be an html element");n=!0;var t=l.getBoundingClientRect();r=e.pageX-t.left+window.pageXOffset,c=e.pageY-t.top+window.pageYOffset,window.addEventListener("mousemove",o)}),window.addEventListener("mouseup",function(e){!0===n&&(n=!1,window.removeEventListener("mousemove",o),t&&t(l,e.pageX,r,e.pageY,c))})},simpleConnect={_idGenerator:0,_connections:{},_getPosition:function(e,t){var n=e.getBoundingClientRect(),o=n.top+window.pageYOffset,i=n.left+window.pageXOffset;if(t){var a=t.getBoundingClientRect();o=n.top-a.top,i=n.left-a.left}return{top:o,vcenter:o+(e.offsetHeight/2|0),bottom:o+e.offsetHeight,left:i,hcenter:i+(e.offsetWidth/2|0),right:i+e.offsetWidth}},_positionCanvas:function(e,t,n){var o=simpleConnect._getPosition(t),i=simpleConnect._getPosition(n);e.style.left=Math.min(o.left,i.left)+"px",e.style.top=Math.min(o.top,i.top)+"px",e.width=Math.max(o.right,i.right)-Math.min(o.left,i.left),e.height=Math.max(o.bottom,i.bottom)-Math.min(o.top,i.top)},_createCanvas:function(e,t,n){var o=document.createElement("canvas");return o.id="canvas_"+n,o.style.zIndex=-1,o.style.position="absolute",document.body.appendChild(o),simpleConnect._positionCanvas(o,e,t),o},connect:function(e,t,n){var o=document.getElementById(e);if(!o)return null;var i=document.getElementById(t);if(!i)return null;var a={};return a.id="simpleConnect_"+simpleConnect._idGenerator++,a.elemA=o,a.elemB=i,a.lineWidth=n&&null!==n.lineWidth&&!isNaN(n.lineWidth)?0|n.lineWidth:4,a.color=n&&null!==n.color?n.color+"":"#000",a.type=!n||null===n.type||"vertical"!==n.type&&"horizontal"!==n.type?"horizontal":n.type,a.offset=n&&null!==n.offset&&!isNaN(n.offset)?0|n.offset:10,a.canvas=simpleConnect._createCanvas(o,i,a.id),a.arrowWidth=n&&null!==n.arrowWidth&&!isNaN(n.arrowWidth)?0|n.arrowWidth:10,a.arrowHeight=n&&null!==n.arrowHeight&&!isNaN(n.arrowHeight)?0|n.arrowHeight:10,simpleConnect._connections[a.id]=a,simpleConnect._populateConnection(a),a.id},repaintConnection:function(e){var t=simpleConnect._connections[e];return!!t&&(simpleConnect._positionCanvas(t.canvas,t.elemA,t.elemB),simpleConnect._populateConnection(t),!0)},_calculateMiddle:function(e,t,n,o){var i=n,a=o;return Math.min(e[o],t[o])>Math.min(e[n],t[n])&&(i=o,a=n),Math.min(e[i],t[i])+Math.abs(Math.max(e[a],t[a])-Math.min(e[i],t[i]))/2|0},_drawConnection:function(e,t,n,o,i){var a="left",r="right",c="vcenter";"vertical"===i&&(a="top",r="bottom",c="hcenter");var l=[],s=n[a]>o[a];if((Math.max(n[a],o[a])-Math.min(n[r],o[r]))/2<=e.offset+e.arrowHeight+e.lineWidth/2+5)return!1;var p=simpleConnect._calculateMiddle(n,o,a,r);return l.push({c1:s?Math.max(n[a]-e.offset,p):Math.min(n[r]+e.offset,p),c2:n[c]}),l.push({c1:p,c2:n[c]}),l.push({c1:p,c2:o[c]}),l.push({c1:s?Math.min(o[r]+e.offset+e.arrowHeight,p):Math.max(o[a]-e.offset-e.arrowHeight,p),c2:o[c]}),simpleConnect._drawPath(t,l,i),0<e.arrowHeight&&0<e.arrowWidth&&simpleConnect._drawArrow(e,t,l[l.length-1],i,s),!0},_drawPath:function(n,e,o){n.beginPath(),e.forEach(function(e,t){0===t?"vertical"===o?n.moveTo(e.c2,e.c1):n.moveTo(e.c1,e.c2):"vertical"===o?n.lineTo(e.c2,e.c1):n.lineTo(e.c1,e.c2)}),n.stroke()},_drawArrow:function(e,t,n,o,i){var a=[];a.push({c1:n.c1,c2:n.c2-e.arrowWidth/2}),a.push({c1:n.c1+(i?-e.arrowHeight:e.arrowHeight),c2:n.c2}),a.push({c1:n.c1,c2:n.c2+e.arrowWidth/2}),simpleConnect._drawPath(t,a,o),t.fill()},_populateConnection:function(e){var t=e.canvas.getContext("2d"),n=simpleConnect._getPosition(e.elemA,e.canvas),o=simpleConnect._getPosition(e.elemB,e.canvas);t.strokeStyle=e.color,t.fillStyle=e.color,t.lineWidth=e.lineWidth,simpleConnect._drawConnection(e,t,n,o,e.type)||simpleConnect._drawConnection(e,t,n,o,"vertical"===e.type?"horizontal":"vertical")},removeConnection:function(e){if(null===simpleConnect._connections[e])return!1;var t=simpleConnect._connections[e].canvas;return t.parentNode.removeChild(t),simpleConnect._connections[e]=null,delete simpleConnect._connections[e],!0}};